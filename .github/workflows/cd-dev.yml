name: Deploy test bot

on:
  push:
    branches: [dev]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.22

      - name: Build app
        run: cd KotatsuTgBot && go build -o kotatsutgbot

      - name: Test
        run: 
          echo "${{ secrets.host }}" | base64 ;
          echo "${{ secrets.user }}" | base64 ;
          echo "${{ secrets.password }}" | base64

      # - name: Copy app to server
      #   run: |
      #     sshpass -p "${{ secrets.password }}"" scp KotatsuTgBot/kotatsutgbot ${{ secrets.user }}@${{ secrets.host }}:/home/kotatsu-admin/dist

      # - name: Deploy and rebuild on server
      #   uses: appleboy/ssh-action@master
      #   with:
      #     host: ${{ secrets.host }}
      #     username: ${{ secrets.user }}
      #     password: ${{ secrets.password }}
      #     script: 
      #       systemctl restart test_kotatsu_bot  &&
      #       systemctl status test_kotatsu_bot
